name: Publish McL-Axios-Kit to npm

on:
  push:
    tags:
      - 'v*' # 'v'로 시작하는 태그 (예: v1.0.0)가 푸시될 때 워크플로우 실행
  release:
    types: [published] # GitHub에서 새 릴리스가 'published' 상태가 될 때 워크플로우 실행 (공식 릴리스에 권장)
  workflow_dispatch: # GitHub Actions 탭에서 수동으로 워크플로우를 실행할 수 있게 함

jobs:
  build-and-publish:
    runs-on: ubuntu-latest
    permissions:
      contents: read # 저장소 콘텐츠를 읽는 권한
      # packages: write # GitHub Packages에 발행할 때 필요한 권한입니다. npmjs.com에 발행할 때는 필수는 아닙니다.

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4 # 현재 저장소 코드를 워크플로우 환경으로 가져옵니다.

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20 # package.json의 devDependencies에 맞게 Node.js 20으로 설정했습니다.
          registry-url: 'https://registry.npmjs.org/' # 패키지를 발행할 npmjs.com 레지스트리 URL입니다.
          cache: 'npm' # npm 캐싱을 활성화하여 의존성 설치 속도를 향상시킵니다.

      - name: Install dependencies
        run: npm ci # package-lock.json 파일을 기반으로 의존성을 설치합니다. (npm install보다 빠르고 안정적)

      - name: Run build script
        # package.json에 정의된 'build' 스크립트를 실행합니다.
        # 이 스텝은 'dist' 디렉토리에 배포할 JavaScript 파일 및 타입 정의 파일을 생성합니다.
        run: npm run build

      # - name: Run tests (Optional)
      #   # 만약 테스트 스크립트가 있다면 이 주석을 해제하고 실행하세요.
      #   # 테스트가 실패하면 배포가 중단되어 안정성을 높일 수 있습니다.
      #   run: npm test

      - name: Publish to npm
        run: npm publish
        # package.json에 "publishConfig": { "access": "public" }이 설정되어 있으므로,
        # 'npm publish' 명령어만으로도 공개 패키지로 발행됩니다.
        # 만약 해당 설정이 없다면 'npm publish --access public'을 사용해야 합니다.
        env:
          NODE_AUTH_TOKEN: ${{ secrets.NPM_TOKEN }} # npm 인증 토큰을 GitHub Secrets에서 가져와 사용합니다.
